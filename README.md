# Documentation for assignment 

Documentation contains informations about services:

 - [Authentication](#Authentication)
 
 - [Creating bank](#Creating-bank)

 - [Updating bank info](#Updating-bank-info)
 
 - [Deactivating bank](#Deactivating-bank)

 - [Creating user](#Creating-user)

 - [Creating bank account](#Creating-bank-account)
 
 - [User transaction](#User-transaction)
 
# Notes for initial starting and testing
Before running app for the first time, database on mysql server needs to be initialised.
Application has liquibase db version control so rest of the work on database will be done by 
application itself. MySQL server needs to be running on port 3306 on local machine and db name needs
to be 'banking'. Username and password of MySQL local server are set to "root" in application.yaml file.
Port, path to db, as well as name, username and password can be changed by user in application.yaml file. 

Application has predefined user for testing and creating other users etc. Test user has ROLE_ADMIN and predefined bank 
account as well. Credentials for logging are:
 
 **username** : `vukadzic`
 
 **password** : `123456`

# Authentication

Service for authentication of user. Only open (unauthorized) endpoint of application.

**URL** : `/login`

**Method** : `POST`

**Auth required** : NO

**Permissions required** : None

**Data constraints**

```json
{
    "username": "[1 to 45 chars]",
    "password": "[1 to 100 chars]"
}
```

## Success Response

**Code** : `200 OK`

**Input Content examples**

Example for user with username "vukadzic" and password "123456".

```json
{
    "username": "vukadzic",
    "password": "123456"
``` 

**Response Content examples**

Service returns created token.

```json
{
  "token":"eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhbmphbWljZXRpYyIsImF1dGgiOiJST0xFX0FETUlOIiwiZXhwIjoxNTk3NjcwMTY2fQ.ohx7ig3wZDD1R7iNTKk3CuHpw8Ee7sZgC7nBFcKo5C8QXFsiBMuVyUfwkMluQlyo10YW0hygjKUcKmW8nn03uw"
}
```

## Fail Response

**Code** : `401 UNAUTHORIZED`

```json
Bad credentials
```

## Notes

* JWT is applied for authorization. Token that user recieves if correct credentials are sent is valid for 1 hour, and among ther things it contains user's role which is important for access to particular services. For every other route, user has to provide token in header of http request, key is "Authorization" and value is "Bearer {recieved token}".

# Creating bank

Service for creating new bank in database

**URL** : `/admin/bank`

**Method** : `POST`

**Auth required** : YES

**Roles required** : ADMIN

**Data constraints**

```json
{
    "name": "[1 to 100 chars]",
    "address": "[1 to 100 chars]"
}
```

## Success Response

**Code** : `201 CREATED`

**Input Content examples**

For a Bank with name "Erste Banka" and address "Cetinjski put br. 3"

```json
{
    "name": "Erste Banka",
    "address": "Cetinjski put br. 3"
}
``` 

**Response Content examples**

Service returns created object.

```json
{
    "id": 2,
    "name": "Erste Banka",
    "address": "Cetinjski put br. 3",
    "bankAccounts": [],
    "active": true"
}
```


## Fail Response

**Code** : `400 BAD_REQUEST`

## Notes

* Bank ID will be generated by DB, and is_active field will be set to true by default
when creating a bank. Data of bank which we want to create is
sent in json format in http body.

# Updating bank info

Service for updating existing bank info.

**URL** : `/admin/bank`

**Method** : `PUT`

**Auth required** : YES

**Roles required** : ADMIN

**Data constraints**

```json
{
    "id": [Integer value],
    "name": "[1 to 100 chars]",
    "address": "[1 to 100 chars]"
}
```

## Success Response

**Code** : `200 OK`

**Content examples**

For a Bank with id=1.

```json
{
    "id": 1,
    "name": "Erste Banka - updated",
    "address": "Cetinjski put br. 3 - updated"
}
```

or

```json
{
    "id": 1,
    "address": "Cetinjski put br. 3 - updated"
}
```

## Fail Response

**Code** : `400 BAD_REQUEST`

## Notes

* This service support partial or complete update of bank info, id is mandatory and other info is optional.Data of bank which we want to update is
sent in json format in http body.

# Deactivating bank

Service for deactivating a bank (setting is_acive field to false)

**URL** : `/admin/bank/deactivate/{id}`

**Method** : `DELETE`

**Auth required** : YES

**Roles required** : ADMIN

**Path variable** : `id:[Integer value]`

## Success Response

**Code** : `200 OK`

## Fail Response

**Code** : `404 NOT_FOUND`

## Notes

* This service deactivates the bank using bank id provided as path variable in url.

# Creating user

Service for creating new user in database

**URL** : `/admin/create-user?roleName=?`

**Method** : `POST`

**Auth required** : YES

**Roles required** : ADMIN

**Data constraints (query params)**

roleName=[1 to 45 char]

**Data constraints**

```json
{
    "fullName":"[1 to 60 chars]",
    "jmbg":"[13 char, can only contain numbers(0-9)]",
    "username":"[1 to 45 char]",
    "password":"[1 to 45 char]",
    "address":"[1 to 100 char]",
    "birthDate":"YYYY-MM-DD",
    "email":"[max 100 char]",
    "phoneNumber": "[max 30 char]"
}
```

## Success Response

**Code** : `201 CREATED`

**Input Content examples**

```json
{
    "fullName":"Vuk Adzic",
    "jmbg":"1907997666666",
    "username":"vukadzic",
    "password":"123456",
    "address":"Zagoric Ulica 13, br 5",
    "birthDate":"1997-07-19",
    "email":"adzic820@gmail.com",
    "phoneNumber": "068006780"
}
```

roleName=ROLE_ADMIN

**Response Content examples**

Service returns created object.

```json
{
    "id": 6,
    "fullName": "Vuk Adzic",
    "jmbg": "1907997666666",
    "username":"vukadzic",
    "password": "123456",
    "address": "Zagoric Ulica 13, br 5",
    "birthDate": "1997-07-19T00:00:00.000+00:00",
    "email": "adzic820@gmail.com",
    "phoneNumber": "067006780",
    "createdAt": "2020-08-14T11:52:10.272+00:00",
    "roles": [
        {
            "id": 2,
            "name": "ROLE_ADMIN",
            "description": "Has access to all services"
        }
    ],
    "bankAccounts": []
}
```


## Fail Response

**Code** : `400 BAD_REQUEST`

## Notes

* Field createdAt is filled automatically by db with current timestamp, and user entity also contains list od bank accounts of user. Data of user which we want to create is
sent in json format in http body. In queryparam nameRole names of roles which should be added to user needs to be sent, separated by comma (",") . In this app, we have 2 roles: "ROLE_USER" and "ROLE_ADMIN".

# Creating bank account

Service for creating new bank account in database. One user can have multiple bank accounts and one account can belong only to one user.

**URL** : `/admin/create-account?jmbg=?&bankId=?`

**Method** : `POST`

**Auth required** : YES

**Roles required** : ADMIN

**Data constraints (query params)**

jmbg:[13 numbers],
bankId: Integer value

**Data constraints (body)**

```json
{
    "accountNumber":"[1 to 45 char]",
    "accountType":"[1 to 45 char]",
    "currentBalance":Double value (default 0.00)
}
```

## Success Response

**Code** : `201 CREATED`

**Input Content examples**

Query params:

jmbg=1907997666666
bankId=1

JSON body:

```json
{
    "accountNumber":"53000000559880",
    "accountType":"Ziro racun",
    "currentBalance":0.00
}
```

**Response Content examples**

Service returns created object.

```json

{
    "id": 7,
    "accountNumber": "530-000005598-80",
    "accountType": "Tekuci racun",
    "currentBalance": 0.0,
    "bank": {
        "id": 1,
        "name": "Erste banka CG-updated",
        "address": "Cetinjski put br. 3",
        "active": true
    },
    "user": {
        "id": 2,
        "fullName": "Vuk Adzic",
        "jmbg": "1907997666666",
        "password": "123456",
        "address": "Zagoric Ulica 13, br 5",
        "birthDate": "1997-07-18T22:00:00.000+00:00",
        "email": "adzic820@gmail.com",
        "phoneNumber": "6800678",
        "createdAt": "2020-08-13T16:11:55.000+00:00",
        "roles": [
            {
                "id": 2,
                "name": "ROLE_ADMIN",
                "description": "Has access to all services"
            }
        ]
    }
}

```


## Fail Response

**Code** : `400 BAD_REQUEST`

## Notes

* In response we have info about the account, id that db automaticlly added and inforamtion about which bank does the account
belong and user who owns the account. When account is created, in query params, the jmbg of user who owns account has to be sent
as well as id of bank that account belongs to.

# User transaction

Service for transfering money from one bank account to other. Data needed for transaction need to be
provided in body of request.

**URL** : `/user/transfer`

**Method** : `PUT`

**Auth required** : YES

**Roles required** : ADMIN || USER

**Data constraints**

```json
{
    "amouth":Double value,
    "fromAccountNumber":"1 to 45 char",
    "toAccountNumber":"1 to 45 char"
}
```

**Input Content examples**

```json
{
    "amouth":550.00,
    "fromAccountNumber":"530-00024894-80",
    "toAccountNumber":"530-00024891-81"
}
```
## Success Response

**Code** : `200 OK`

## Fail Response

**Code** : `400 BAD_REQUEST`

## Notes

* For money transaction, user has to provide amouth of funds that user wants to transfer (amouth),number of account from which user wants to transfer funds (fromAccountNumber) and number of account to which funds should be transfered (toAccountNumber). Service checks does account from which funds are being transfered belong to user who is making the transfer. Info of user who is making the transfer is extracted from SecurityContextHolder, or more generaly from jwt token in header of request.
Service also checks does the user have enough money to make the transaction.
